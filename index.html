<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Elegant Memo Â· Rich Multi Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", Roboto, "Noto Sans KR", system-ui, -sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #202637 0, #050712 55%, #020308 100%);
      color: #f5f5f7;
    }

    .memo-wrapper {
      width: min(1160px, 96vw);
      padding: 24px;
      border-radius: 24px;
      background: rgba(9, 11, 24, 0.78);
      backdrop-filter: blur(18px);
      box-shadow:
        0 18px 55px rgba(0, 0, 0, 0.65),
        0 0 0 1px rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(128, 160, 255, 0.28);
    }

    .memo-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 12px;
    }

    .memo-title-area {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .logo-line {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(200, 210, 255, 0.75);
    }

    .logo-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #6ae3ff, #406bff);
      box-shadow: 0 0 12px rgba(64, 107, 255, 0.9);
    }

    .memo-title {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .memo-subtitle {
      font-size: 13px;
      color: rgba(220, 225, 255, 0.65);
    }

    .memo-status {
      text-align: right;
      font-size: 12px;
      color: rgba(200, 205, 240, 0.72);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      margin-right: 4px;
      background: radial-gradient(circle at 30% 30%, #4af39f, #0da36a);
      box-shadow: 0 0 10px rgba(74, 243, 159, 0.9);
    }

    .memo-date {
      opacity: 0.8;
    }

    .memo-shell {
      display: flex;
      gap: 18px;
      margin-top: 10px;
    }

    /* SIDEBAR */
    .memo-sidebar {
      width: 270px;
      min-width: 230px;
      background: rgba(7, 10, 26, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(100, 122, 255, 0.55);
      padding: 10px 10px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .sidebar-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(205, 214, 255, 0.86);
    }

    .sidebar-sub {
      font-size: 11px;
      color: rgba(170, 180, 220, 0.7);
      margin-bottom: 3px;
    }

    .note-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 380px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 2px;
    }

    .note-list::-webkit-scrollbar {
      width: 6px;
    }
    .note-list::-webkit-scrollbar-thumb {
      background: rgba(121, 134, 255, 0.75);
      border-radius: 999px;
    }
    .note-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .note-item {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(80, 101, 190, 0.7);
      padding: 7px 9px;
      background: radial-gradient(circle at top left, rgba(32, 40, 92, 0.9), rgba(10, 16, 46, 0.96));
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 12px;
      color: rgba(226, 232, 255, 0.92);
      transition: transform 0.12s ease, box-shadow 0.12s ease, border 0.12s ease,
        background 0.12s ease;
      position: relative;
      cursor: pointer;
    }

    .note-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.45);
      border-color: rgba(150, 179, 255, 1);
    }

    .note-item.active {
      border-color: rgba(178, 203, 255, 1);
      box-shadow: 0 0 0 1px rgba(160, 190, 255, 0.9),
        0 12px 30px rgba(0, 0, 0, 0.6);
      background: radial-gradient(circle at top left, #4e5dff, #141936);
    }

    .note-title-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .note-title-text {
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .note-pill {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(210, 222, 255, 0.7);
      background: rgba(10, 12, 38, 0.9);
    }

    .note-updated {
      font-size: 10px;
      opacity: 0.8;
    }

    .note-preview {
      font-size: 11px;
      opacity: 0.75;
      max-height: 32px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .note-delete {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(240, 120, 140, 0.8);
      background: rgba(40, 10, 25, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: rgba(255, 190, 210, 0.9);
      cursor: pointer;
      opacity: 0.0;
      transition: opacity 0.12s ease, transform 0.12s ease;
    }

    .note-item:hover .note-delete {
      opacity: 1;
    }
    .note-delete:hover {
      transform: scale(1.05);
    }

    .memo-main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .title-input {
      width: 100%;
      background: rgba(7, 10, 26, 0.95);
      border-radius: 16px;
      border: 1px solid rgba(110, 135, 255, 0.5);
      padding: 10px 14px;
      color: #f9fafb;
      font-size: 15px;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      margin-bottom: 10px;
    }
    .title-input::placeholder {
      color: rgba(200, 205, 240, 0.6);
    }
    .title-input:focus {
      border-color: rgba(138, 180, 255, 0.95);
      box-shadow: 0 0 0 1px rgba(138, 180, 255, 0.6),
        0 0 30px rgba(59, 130, 246, 0.35);
      background: rgba(5, 8, 22, 1);
    }

    .memo-body {
      border-radius: 20px;
      background: radial-gradient(circle at top left, #151b33, #050712 55%);
      border: 1px solid rgba(86, 110, 255, 0.55);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 260px;
    }

    .memo-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      border-bottom: 1px solid rgba(120, 140, 255, 0.3);
      background: linear-gradient(
        90deg,
        rgba(33, 43, 89, 0.9),
        rgba(12, 19, 54, 0.9)
      );
      gap: 6px;
      flex-wrap: wrap;
    }

    .toolbar-left,
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(158, 185, 255, 0.7);
      background: rgba(7, 10, 36, 0.9);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(222, 230, 255, 0.86);
    }

    .counter {
      font-size: 12px;
      color: rgba(210, 220, 255, 0.76);
    }

    .tool-btn {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(23, 32, 88, 0.6);
      color: rgba(228, 235, 255, 0.9);
      border: 1px solid rgba(146, 170, 255, 0.7);
      min-width: 24px;
      transition: background 0.12s ease, transform 0.12s ease, box-shadow 0.12s ease;
    }
    .tool-btn:hover {
      background: rgba(40, 56, 135, 0.95);
      transform: translateY(-0.5px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
    }
    .tool-btn.active {
      background: rgba(79, 99, 210, 1);
    }

    .tool-select {
      border-radius: 999px;
      border: 1px solid rgba(146, 170, 255, 0.7);
      background: rgba(9, 13, 40, 0.95);
      color: rgba(230, 236, 255, 0.95);
      font-size: 11px;
      padding: 4px 10px;
      outline: none;
    }

    .color-input-wrapper {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: rgba(220, 228, 255, 0.9);
    }

    .color-input-wrapper input[type="color"] {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(170, 190, 255, 0.9);
      padding: 0;
      background: transparent;
      cursor: pointer;
    }

    .btn {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(23, 32, 88, 0.95);
      color: rgba(228, 235, 255, 0.9);
      border: 1px solid rgba(146, 170, 255, 0.8);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease, border 0.12s ease;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.45),
        0 0 16px rgba(128, 156, 255, 0.6);
      background: rgba(38, 50, 120, 1);
      border-color: rgba(186, 201, 255, 1);
    }
    .btn:active {
      transform: translateY(0px) scale(0.98);
      box-shadow: none;
    }
    .btn-ghost {
      background: transparent;
      border-color: rgba(130, 146, 210, 0.65);
      color: rgba(200, 210, 240, 0.9);
    }
    .btn-ghost:hover {
      background: rgba(24, 32, 80, 0.9);
    }
    .btn-danger {
      border-color: rgba(240, 120, 140, 0.9);
      color: rgba(255, 210, 220, 0.95);
      background: rgba(70, 20, 35, 0.95);
    }
    .btn-danger:hover {
      background: rgba(120, 35, 55, 0.98);
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.55);
    }

    .btn-icon {
      font-size: 14px;
    }

    .memo-editor {
      flex: 1;
      padding: 14px 18px 18px;
      font-size: 14px;
      line-height: 1.7;
      outline: none;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(121, 134, 255, 0.9) transparent;
    }

    .memo-editor[contenteditable="true"]:empty:before {
      content: attr(data-placeholder);
      color: rgba(180, 190, 230, 0.6);
      pointer-events: none;
    }

    .memo-editor::-webkit-scrollbar {
      width: 8px;
    }
    .memo-editor::-webkit-scrollbar-track {
      background: transparent;
    }
    .memo-editor::-webkit-scrollbar-thumb {
      background: rgba(121, 134, 255, 0.7);
      border-radius: 999px;
    }

    .memo-footer {
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      color: rgba(190, 198, 230, 0.65);
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(98, 120, 255, 0.7);
      background: radial-gradient(circle at 0 0, #4358ff, #1b2048);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(235, 240, 255, 0.92);
    }

    @media (max-width: 900px) {
      .memo-wrapper {
        padding: 18px;
        border-radius: 18px;
      }
      .memo-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .memo-shell {
        flex-direction: column;
      }
      .memo-sidebar {
        width: 100%;
        order: 2;
      }
      .memo-main {
        order: 1;
      }
      .memo-title {
        font-size: 20px;
      }
      .memo-body {
        border-radius: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="memo-wrapper">
    <header class="memo-header">
      <div class="memo-title-area">
        <div class="logo-line">
          <span class="logo-dot"></span>
          ELEGANT MEMO
        </div>
        <div class="memo-title">Rich Multi Notebook</div>
        <div class="memo-subtitle">
          ì—¬ëŸ¬ ê°œì˜ ë©”ëª¨ë¥¼ ë§Œë“¤ê³ , ê¸€ì í¬ê¸°Â·ìƒ‰ìƒÂ·í˜•ê´‘íœÂ·ë§í¬ê¹Œì§€ ììœ ë¡­ê²Œ ê¾¸ë©°ë³´ì„¸ìš”.
        </div>
      </div>
      <div class="memo-status">
        <div>
          <span class="status-dot"></span>
          <span id="save-status">ìë™ ì €ì¥ ì¤€ë¹„ë¨</span>
        </div>
        <div class="memo-date">
          ì˜¤ëŠ˜ Â· <span id="today-string"></span>
        </div>
      </div>
    </header>

    <div class="memo-shell">
      <!-- ì™¼ìª½: ë©”ëª¨ ë¦¬ìŠ¤íŠ¸ -->
      <aside class="memo-sidebar">
        <div class="sidebar-header">
          <div class="sidebar-title">MY NOTES</div>
          <button class="btn btn-ghost" id="btn-new">
            <span class="btn-icon">ï¼‹</span> ìƒˆ ë©”ëª¨
          </button>
        </div>
        <div class="sidebar-sub">ê° ë©”ëª¨ëŠ” ë¡œì»¬ì— ì €ì¥ë˜ë©°, ì–¸ì œë“  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        <div id="note-list" class="note-list"></div>
      </aside>

      <!-- ì˜¤ë¥¸ìª½: í˜„ì¬ ì„ íƒëœ ë©”ëª¨ -->
      <main class="memo-main">
        <input
          id="note-title"
          class="title-input"
          type="text"
          placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì˜¤ëŠ˜ì˜ ì•„ì´ë””ì–´, í•  ì¼, ê³µë¶€ ë©”ëª¨ ë“±)"
        />

        <section class="memo-body">
          <div class="memo-toolbar">
            <div class="toolbar-left">
              <span class="chip">Rich Text Â· Local Only</span>

              <!-- ê¸€ì í¬ê¸° (px ë‹¨ìœ„ ìˆ«ì) -->
              <select id="font-size-select" class="tool-select">
                <option value="">í¬ê¸°(px)</option>
                <option value="10">10</option>
                <option value="12">12</option>
                <option value="14">14</option>
                <option value="16">16</option>
                <option value="20">20</option>
                <option value="24">24</option>
                <option value="30">30</option>
                <option value="40">40</option>
              </select>

              <!-- B I U -->
              <button class="tool-btn" data-cmd="bold"><b>B</b></button>
              <button class="tool-btn" data-cmd="italic"><i>I</i></button>
              <button class="tool-btn" data-cmd="underline"><u>U</u></button>

              <!-- ìƒ‰ê¹” / í˜•ê´‘íœ -->
              <span class="color-input-wrapper">
                A
                <input type="color" id="color-fore" title="ê¸€ììƒ‰" value="#ffffff" />
              </span>
              <span class="color-input-wrapper">
                â–‰
                <input type="color" id="color-back" title="í˜•ê´‘íœ" value="#fff59d" />
              </span>

              <!-- ë§í¬ -->
              <button class="tool-btn" id="btn-link">ğŸ”—</button>
              <button class="tool-btn" id="btn-unlink" title="ë§í¬ ì œê±°">â¨‰</button>

              <!-- ë¦¬ìŠ¤íŠ¸ -->
              <button class="tool-btn" data-cmd="insertUnorderedList">â€¢ ëª©ë¡</button>
              <button class="tool-btn" data-cmd="insertOrderedList">1. ëª©ë¡</button>

              <!-- ì´ˆê¸°í™” -->
              <button class="tool-btn" id="btn-clear-format" title="ì„œì‹ ì œê±°">CLR</button>
            </div>

            <div class="toolbar-right">
              <span class="counter" id="char-count">0 ê¸€ì</span>
              <button class="btn" id="btn-save">
                <span class="btn-icon">ğŸ’¾</span> ì €ì¥
              </button>
              <button class="btn btn-ghost" id="btn-clear">
                <span class="btn-icon">ğŸ§¹</span> ë‚´ìš© ì§€ìš°ê¸°
              </button>
              <button class="btn btn-danger" id="btn-delete-current">
                <span class="btn-icon">ğŸ—‘ï¸</span> ë©”ëª¨ ì‚­ì œ
              </button>
            </div>
          </div>

          <div
            id="memo-editor"
            class="memo-editor"
            contenteditable="true"
            data-placeholder="ì´ ë©”ëª¨ì— ì ê³  ì‹¶ì€ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”.&#10;&#10;ì˜ˆì‹œ)&#10;- í˜•ê´‘íœìœ¼ë¡œ ê°•ì¡°í•˜ê³  ì‹¶ì€ ë¬¸ì¥&#10;- ë§í¬ê°€ ìˆëŠ” ì°¸ê³  ìë£Œ&#10;- ìƒ‰ê¹”ë³„ ì •ë¦¬ ë©”ëª¨"
          ></div>
        </section>

        <footer class="memo-footer">
          <div>
            <span class="badge">offline first</span>
            <span style="margin-left: 8px;">ëª¨ë“  ë©”ëª¨ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ ë¡œì»¬ ì €ì¥ì†Œì—ë§Œ ë³´ê´€ë©ë‹ˆë‹¤.</span>
          </div>
          <div id="last-saved-time">ë§ˆì§€ë§‰ ì €ì¥: ì•„ì§ ì—†ìŒ</div>
        </footer>
      </main>
    </div>
  </div>

  <script>
    (function () {
      const LS_KEY = "elegant_memo_rich_multi_notes_v1";

      const titleInput = document.getElementById("note-title");
      const editor = document.getElementById("memo-editor");
      const charCount = document.getElementById("char-count");
      const saveStatus = document.getElementById("save-status");
      const lastSavedTime = document.getElementById("last-saved-time");
      const todayString = document.getElementById("today-string");

      const btnSave = document.getElementById("btn-save");
      const btnNew = document.getElementById("btn-new");
      const btnClear = document.getElementById("btn-clear");
      const btnDeleteCurrent = document.getElementById("btn-delete-current");
      const noteList = document.getElementById("note-list");

      const fontSizeSelect = document.getElementById("font-size-select");
      const colorForeInput = document.getElementById("color-fore");
      const colorBackInput = document.getElementById("color-back");
      const btnLink = document.getElementById("btn-link");
      const btnUnlink = document.getElementById("btn-unlink");
      const btnClearFormat = document.getElementById("btn-clear-format");

      let state = {
        notes: [],
        activeId: null,
      };

      function formatDateForHeader(date) {
        const days = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        const weekday = days[date.getDay()];
        return `${year}.${month}.${day} (${weekday})`;
      }

      function formatFullDateTime(date) {
        const base = formatDateForHeader(date);
        const h = String(date.getHours()).padStart(2, "0");
        const m = String(date.getMinutes()).padStart(2, "0");
        const s = String(date.getSeconds()).padStart(2, "0");
        return `${base} ${h}:${m}:${s}`;
      }

      todayString.textContent = formatDateForHeader(new Date());

      function updateCharCount() {
        const text = editor.innerText || "";
        charCount.textContent = `${text.length.toLocaleString()} ê¸€ì`;
      }

      function loadFromLocalStorage() {
        try {
          const raw = localStorage.getItem(LS_KEY);
          if (!raw) return;
          const data = JSON.parse(raw);
          if (Array.isArray(data.notes)) {
            state.notes = data.notes;
          }
          if (data.activeId) {
            state.activeId = data.activeId;
          }
        } catch (e) {
          console.error("ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜:", e);
        }
      }

      function saveState() {
        try {
          localStorage.setItem(LS_KEY, JSON.stringify(state));
        } catch (e) {
          console.error("ìƒíƒœ ì €ì¥ ì¤‘ ì˜¤ë¥˜:", e);
          saveStatus.textContent = "ì €ì¥ ì‹¤íŒ¨ (ë¡œì»¬ ì €ì¥ì†Œ ìš©ëŸ‰ ë“±)";
        }
      }

      function getActiveNote() {
        if (!state.activeId) return null;
        return state.notes.find((n) => n.id === state.activeId) || null;
      }

      function escapeHtml(str) {
        return String(str)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function getPlainTextFromHtml(html) {
        const tmp = document.createElement("div");
        tmp.innerHTML = html || "";
        return (tmp.textContent || tmp.innerText || "").trim();
      }

      function renderNotesList() {
        if (!state.notes.length) {
          noteList.innerHTML =
            '<div style="font-size:12px; color:rgba(180,190,230,0.8); padding:4px 2px;">ì•„ì§ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤. <strong>ìƒˆ ë©”ëª¨</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•´ ë³´ì„¸ìš”.</div>';
          return;
        }

        noteList.innerHTML = state.notes
          .map((note) => {
            const isActive = note.id === state.activeId;
            const title = note.title && note.title.trim()
              ? note.title.trim()
              : "ì œëª© ì—†ìŒ";
            const preview = getPlainTextFromHtml(note.contentHtml);
            const previewShort = preview || "ë‚´ìš© ì—†ìŒ";
            const updated = note.updatedAt || "ì €ì¥ ê¸°ë¡ ì—†ìŒ";

            return `
              <div class="note-item ${isActive ? "active" : ""}" data-id="${note.id}">
                <div class="note-title-line">
                  <div class="note-title-text">${escapeHtml(title)}</div>
                  <div class="note-pill">${isActive ? "ACTIVE" : "NOTE"}</div>
                </div>
                <div class="note-updated">${escapeHtml(updated)}</div>
                <div class="note-preview">${escapeHtml(previewShort)}</div>
                <div class="note-delete" data-id="${note.id}" title="ë©”ëª¨ ì‚­ì œ">Ã—</div>
              </div>
            `;
          })
          .join("");

        const items = noteList.querySelectorAll(".note-item");
        items.forEach((el) => {
          el.addEventListener("click", (e) => {
            const target = e.target;
            if (target.classList.contains("note-delete")) return;
            const id = el.getAttribute("data-id");
            switchNote(id);
          });
        });

        const deleteButtons = noteList.querySelectorAll(".note-delete");
        deleteButtons.forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const id = btn.getAttribute("data-id");
            deleteNoteById(id);
          });
        });
      }

      function renderActiveNote() {
        const note = getActiveNote();
        if (!note) {
          titleInput.value = "";
          editor.innerHTML = "";
          lastSavedTime.textContent = "ë§ˆì§€ë§‰ ì €ì¥: ì•„ì§ ì—†ìŒ";
          updateCharCount();
          return;
        }
        titleInput.value = note.title || "";
        editor.innerHTML = note.contentHtml || "";
        lastSavedTime.textContent = note.updatedAt
          ? `ë§ˆì§€ë§‰ ì €ì¥: ${note.updatedAt}`
          : "ë§ˆì§€ë§‰ ì €ì¥: ì•„ì§ ì—†ìŒ";
        updateCharCount();
        saveStatus.textContent = "ìë™ ì €ì¥ ì¤€ë¹„ë¨";
        saveStatus.style.opacity = "0.8";
      }

      function ensureAtLeastOneNote() {
        if (!state.notes.length) {
          const now = new Date();
          const id = String(now.getTime());
          const newNote = {
            id,
            title: "",
            contentHtml: "",
            updatedAt: "",
          };
          state.notes.push(newNote);
          state.activeId = id;
          saveState();
        } else if (!state.activeId) {
          state.activeId = state.notes[0].id;
          saveState();
        }
      }

      function saveActiveNote(options = {}) {
        const { manual = false, silent = false } = options;
        const note = getActiveNote();
        if (!note) return;

        const now = new Date();
        note.title = titleInput.value.trim();
        note.contentHtml = editor.innerHTML;
        note.updatedAt = formatFullDateTime(now);

        saveState();
        renderNotesList();

        if (!silent) {
          lastSavedTime.textContent = `ë§ˆì§€ë§‰ ì €ì¥: ${note.updatedAt}`;
          saveStatus.textContent = manual ? "ìˆ˜ë™ ì €ì¥ ì™„ë£Œ" : "ìë™ ì €ì¥ë¨";
          saveStatus.style.opacity = "1";
          setTimeout(() => {
            saveStatus.style.opacity = "0.7";
            saveStatus.textContent = "ìë™ ì €ì¥ ì¤€ë¹„ë¨";
          }, 1200);
        }
      }

      function switchNote(newId) {
        if (!newId || newId === state.activeId) return;
        saveActiveNote({ manual: false, silent: true });
        state.activeId = newId;
        saveState();
        renderNotesList();
        renderActiveNote();
        saveStatus.textContent = "ë©”ëª¨ ì „í™˜ë¨";
        saveStatus.style.opacity = "1";
        setTimeout(() => {
          saveStatus.style.opacity = "0.7";
          saveStatus.textContent = "ìë™ ì €ì¥ ì¤€ë¹„ë¨";
        }, 900);
      }

      function createNewNote(withConfirm = true) {
        const currentNote = getActiveNote();
        if (withConfirm && currentNote) {
          if (currentNote.title || getPlainTextFromHtml(currentNote.contentHtml)) {
            const ok = confirm(
              "í˜„ì¬ ë©”ëª¨ ë‚´ìš©ì´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\nìƒˆ ë©”ëª¨ë¥¼ ì—¬ì‹œê² ìŠµë‹ˆê¹Œ?"
            );
            if (!ok) return;
          }
        }

        saveActiveNote({ manual: false, silent: true });

        const now = new Date();
        const id = String(now.getTime());
        const newNote = {
          id,
          title: "",
          contentHtml: "",
          updatedAt: "",
        };
        state.notes.unshift(newNote);
        state.activeId = id;
        saveState();
        renderNotesList();
        renderActiveNote();
        titleInput.focus();
      }

      function clearContent() {
        const note = getActiveNote();
        if (!note) return;
        if (!editor.innerHTML.trim()) return;
        const ok = confirm("ì´ ë©”ëª¨ì˜ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (ì œëª©ì€ ìœ ì§€ë©ë‹ˆë‹¤)");
        if (!ok) return;
        editor.innerHTML = "";
        updateCharCount();
        saveActiveNote({ manual: false, silent: false });
        saveStatus.textContent = "ë‚´ìš© ì§€ì›Œì§";
        saveStatus.style.opacity = "1";
        setTimeout(() => {
          saveStatus.style.opacity = "0.7";
          saveStatus.textContent = "ìë™ ì €ì¥ ì¤€ë¹„ë¨";
        }, 900);
      }

      function deleteNoteById(id) {
        if (!id) return;
        const note = state.notes.find((n) => n.id === id);
        const title = note && note.title ? note.title : "ì´ ë©”ëª¨";
        const ok = confirm(`ì •ë§ë¡œ "${title}" ë¥¼(ì„) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        if (!ok) return;

        state.notes = state.notes.filter((n) => n.id !== id);

        if (!state.notes.length) {
          const now = new Date();
          const newId = String(now.getTime());
          const newNote = {
            id: newId,
            title: "",
            contentHtml: "",
            updatedAt: "",
          };
          state.notes.push(newNote);
          state.activeId = newId;
        } else {
          if (state.activeId === id) {
            state.activeId = state.notes[0].id;
          }
        }

        saveState();
        renderNotesList();
        renderActiveNote();
        saveStatus.textContent = "ë©”ëª¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤";
        saveStatus.style.opacity = "1";
        setTimeout(() => {
          saveStatus.style.opacity = "0.7";
          saveStatus.textContent = "ìë™ ì €ì¥ ì¤€ë¹„ë¨";
        }, 900);
      }

      let autoSaveTimer = null;
      function scheduleAutoSave() {
        if (autoSaveTimer) clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(() => {
          saveActiveNote({ manual: false, silent: false });
        }, 900);
      }

      // ---- Rich Text Formatting ----
      document.querySelectorAll(".tool-btn[data-cmd]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const cmd = btn.getAttribute("data-cmd");
          document.execCommand(cmd, false, null);
          editor.focus();
        });
      });

      // ê¸€ì í¬ê¸°(px) ì ìš©: execCommand("fontSize") + font íƒœê·¸ë¥¼ pxë¡œ ë³€í™˜
      fontSizeSelect.addEventListener("change", () => {
        const val = fontSizeSelect.value;
        if (!val) return;
        const px = parseInt(val, 10);
        if (!px) return;

        // ìš°ì„  ë¸Œë¼ìš°ì € ê¸°ë³¸ fontSize ëª…ë ¹(1~7ë‹¨ê³„)ì„ ì‚¬ìš©
        document.execCommand("fontSize", false, "7"); // ì„ì‹œë¡œ 7ë‹¨ê³„ ì‚¬ìš©

        // editor ì•ˆì—ì„œ size="7"ì¸ font íƒœê·¸ ì°¾ì•„ì„œ pxë¡œ ë°”ê¾¸ê¸°
        const fonts = editor.querySelectorAll("font[size='7']");
        fonts.forEach((el) => {
          el.removeAttribute("size");
          el.style.fontSize = px + "px";
        });

        editor.focus();
        // ì„ íƒ ì´ˆê¸°í™”
        fontSizeSelect.selectedIndex = 0;
      });

      colorForeInput.addEventListener("input", () => {
        document.execCommand("foreColor", false, colorForeInput.value);
        editor.focus();
      });

      colorBackInput.addEventListener("input", () => {
        document.execCommand("hiliteColor", false, colorBackInput.value);
        editor.focus();
      });

      btnLink.addEventListener("click", () => {
        const url = prompt("ì—°ê²°í•  URLì„ ì…ë ¥í•˜ì„¸ìš”:", "https://");
        if (!url) return;
        document.execCommand("createLink", false, url);
        editor.focus();
      });

      btnUnlink.addEventListener("click", () => {
        document.execCommand("unlink", false, null);
        editor.focus();
      });

      // CLR: ì„œì‹ ì‹¹ ì§€ìš°ê¸° (ì„ íƒëœ ë²”ìœ„ê°€ ì—†ìœ¼ë©´ ì „ì²´)
      btnClearFormat.addEventListener("click", () => {
        const sel = window.getSelection();
        if (!sel.rangeCount) return;

        // ì„ íƒì´ ì—†ìœ¼ë©´ ì „ì²´ ì„ íƒ
        if (sel.isCollapsed) {
          const r = document.createRange();
          r.selectNodeContents(editor);
          sel.removeAllRanges();
          sel.addRange(r);
        }

        // ê¸°ë³¸ ì„œì‹ ì œê±° + ë§í¬ ì œê±°
        document.execCommand("removeFormat", false, null);
        document.execCommand("unlink", false, null);

        // editor ë‚´ë¶€ span, font íƒœê·¸ ìŠ¤íƒ€ì¼ ì •ë¦¬
        editor.querySelectorAll("span, font").forEach((el) => {
          el.removeAttribute("style");
          el.removeAttribute("size");
          // ë” ì´ìƒ ì“¸ ì†ì„±ì´ ì—†ê³  ë‹¨ìˆœ ë˜í¼ë©´ ë²—ê²¨ë²„ë¦¬ê¸°
          if (el.attributes.length === 0) {
            const parent = el.parentNode;
            while (el.firstChild) {
              parent.insertBefore(el.firstChild, el);
            }
            parent.removeChild(el);
          }
        });

        editor.focus();
      });

      // ---- ì´ë²¤íŠ¸ ----
      editor.addEventListener("input", () => {
        updateCharCount();
        saveStatus.textContent = "ì…ë ¥ ì¤‘â€¦";
        saveStatus.style.opacity = "1";
        scheduleAutoSave();
      });

      titleInput.addEventListener("input", () => {
        saveStatus.textContent = "ì œëª© ìˆ˜ì • ì¤‘â€¦";
        saveStatus.style.opacity = "1";
        scheduleAutoSave();
      });

      btnSave.addEventListener("click", () => {
        saveActiveNote({ manual: true, silent: false });
      });

      btnNew.addEventListener("click", () => {
        createNewNote(true);
      });

      btnClear.addEventListener("click", clearContent);

      btnDeleteCurrent.addEventListener("click", () => {
        const active = getActiveNote();
        if (!active) return;
        deleteNoteById(active.id);
      });

      // ì´ˆê¸° ì‹¤í–‰
      loadFromLocalStorage();
      ensureAtLeastOneNote();
      renderNotesList();
      renderActiveNote();
      updateCharCount();
    })();
  </script>
</body>
</html>
